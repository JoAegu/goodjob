<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.goodjob.notice">
<insert id="noticeWrite" parameterType="com.goodjob.notice.model.NoticeDTO">
insert into notice
values(notice_idx.nextval,#{plan_idx},#{com_idx},#{subject},#{gender},#{min_age},#{max_age},#{grade},#{job},#{service_type},#{recruit},#{period},#{workday},#{starttime},#{finishtime},#{pay_category},#{pay_hour},#{pay_month},#{worktime},#{local1},#{local2},#{local3},#{detail_addr},#{x},#{y},#{com_name},#{manager_name},#{manager_tel},#{manager_email},#{content},sysdate,sysdate+30,0,'활성')
</insert>
<select id="comNoticeList" parameterType="Map" resultType="com.goodjob.notice.model.NoticeDTO">
select * from
		(select rownum as rnum,a.* from
		(
SELECT
notice.idx,
notice.writedate,
notice.deadline,
notice.subject,
notice.com_name,
plan.plan_name period,
COUNT(DISTINCT apply.idx) ref,
COUNT(DISTINCT CASE WHEN apply."CHECK" = 0 THEN apply.idx END) recruit
FROM
notice
INNER JOIN plan ON notice.plan_idx = plan.idx
LEFT JOIN apply ON notice.idx = apply.notice_idx
WHERE
notice.com_idx = #{idx}
AND notice.status = '활성'
GROUP BY
notice.idx,
notice.writedate,
notice.deadline,
notice.subject,
notice.com_name,
plan.plan_name
ORDER BY
notice.idx DESC
) a) b
		where <![CDATA[rnum>=]]>#{start} and rnum<![CDATA[<=]]>#{end}
</select>
<select id="noticeTotalCnt" parameterType="Integer" resultType="Integer">
select count(*) from notice where com_idx=#{idx} and status='활성'
</select>
<select id="noticeContent" parameterType="Integer" resultType="com.goodjob.notice.model.NoticeDTO">
select * from notice where idx=#{idx} and status='활성'
</select>
<update id="noticeDel" parameterType="Integer">
update notice set status='비활성' where idx=#{idx}
</update>
  </mapper>