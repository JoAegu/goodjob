<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goodjob.review">
	<select id="reviewList"
		resultType="com.goodjob.review.model.ReviewDTO">
		select com_name from review group
		by com_name
	</select>
<!-- 	<select id="reviewList"
		resultType="com.goodjob.review.model.ReviewDTO">
		select com_name, count(*) as member_idx from review group
		by com_name
	</select> -->
	<insert id="reviewWrite"
		parameterType="com.goodjob.review.model.ReviewDTO">
		insert into review values(review_idx.nextval,
		#{member_idx}, #{review_num}, #{com_name}, sysdate, #{keyword},'활성')
	</insert>
	<select id="reviewSetReviewNum" resultType="Integer">
		select
		Max(review_num) as review_num from review
	</select>
	<select id="reviewList2" parameterType="Map" resultType="com.goodjob.review.model.ReviewDTO" >
		
		select com_name, content as keyword, keyword_count as member_idx from
		(select rownum as rnum, a.*,

		(select count(*) from review r where r.com_name = a.com_name) as
		keyword_count
		from
		(SELECT r.com_name, k.content, TO_CHAR(r.keyword) as keyword
		FROM review r
		inner join keyword k on k.idx=r.keyword
		WHERE com_name = #{com_name}
		GROUP BY r.com_name, k.content, TO_CHAR(r.keyword)
		ORDER BY r.com_name, count(keyword) desc) a
		) b
		where rnum<![CDATA[<=]]>3
	</select>
</mapper>